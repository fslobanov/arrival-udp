# arrival-udp

Тестовое задание на вакансию C++ Developer в Connected Vehicle Platform / OTA team
===========================================================================
Нужно написать сервис рассылки времени, который броадкастом  (UDP) рассылает свой таймстемп клиентам.
Сервер берет время из системы и отдает клиентам раз в 100ms, в виде таймстемпа(ms).
Клиент, получает время и печатает в консоль:
1. свой таймстемп (в момент приема пакета)
2. полученный таймстемп от сервера
3. diff (в ms) таймстемпов сервера и клиента.
   При получении сигнала SIGUSR2 программы должна корректно завершаться.
   Логику работы с временем сервера/клиентам нужно развязать с реализацией передачи времени на транспортном уровне.
   Сервер и клиента нужно написать на С++, используются только стандартные библиотеки C++, без 3rd party.
   Для сборки используем cmake (будет плюсом добавить опцию для сборки приложений с использованием санитайзеров).
   Для тестового задания, ограничимся рамками одной Linux машины (localhost).
   Сервер и клиент должны собираться из исходников, запускаться и работать, как описано в задание.
   Обязательно наличие юнит тестов (гнаться за покрытием не надо, лучше покрыть часть функционала, но хорошо)


# Решение
## Дизайн

- Отправка и генерация/разбор пакетов отделены друг от друга на уровне классов.
- Прием передача и обработка разнесены по потокам.
- Доставка сообщений объектам осуществляется с помощью потоков событий (далее streams), извне объекты получают данные только через stream.
- stream - фактически очередь на мьютексе + коллбек, который оповещает подписчика очереди.
- Предусмотрена разблокировка stream при его закрытии и отсутствии новых данных.
- В качестве бонуса streams дают эффект буферизации.
- Приложение блокирует основной поток выполнения, и ждет сигнала завершения, после чего завершается.
- Сигнал USR2 синхронно ожидается в отдельном потоке, после чего оповещает приложение.
- Таймер просто спит в потоке, периодически вызывает коллбек.
- Ничего не делалось для async-signal-safe, при поступлении USR2 просто вызываются коллбеки.
- Ничего не делалось для диспетчеризации событий - чтобы на одном потоке можно было держать несколько объектов|очередей.
- Ничего не делалось для нормального разрушения таймера, например, разбиение на маленькие периоды + счетчик.
- Не использовались никакие нативные асинхронные API.

## Google Test

- cmake ... -DArrivalUdp_BUILD_TESTS=ON
- В качестве объекта данных: core::address_t
- В качестве объекта с поведением: server::gateway_t

## Sanitizers

- cmake ... -DArrivalUdp_SANITIZER=< none|address|thread|leak|undefined >